% \documentclass{article}
% \usepackage[ruled,vlined,linesnumbered]{algorithm2e}
% \usepackage{amsmath}

% % Optional: Define a command for code-like text if you prefer a specific style
% \newcommand{\code}[1]{\texttt{#1}}

% \begin{document}

\begin{algorithm}[tbp]
    \caption{Update $L$ when adding a new 2Q gate}
    \label{alg:update_L_D_C}

    \SetKwInOut{KwIn}{Input}
    \SetKwInOut{KwOut}{Output}

    \KwIn{
        $G'$ (Routed DAG), 
        $\pi$ (current logic-to-physical mapping), 
        $L$ (last mapped layer), 
        $D$ (wire durations for each qubit), 
        $C$ (commutative pairs within $L$)
    }
    \KwOut{Updated $G'$, $L$, $D$, $C$}

    \BlankLine

    \tcc{$g$: resolved logical gate;\, $g'$: routed gate}
    $g' \leftarrow G'.\textsc{pushBack}(g, \pi[g.q_0], \pi[g.q_1])$;\, \tcp{$g'.q_i = \pi[g.q_i]$}

    $d \leftarrow \textsc{max}(D[g'.q_0],\, D[g'.q_1]) + \textsc{synthCost}(g)$\;
    $D[g'.q_0] \leftarrow d$; $D[g'.q_1] \leftarrow d$\;

    \For{$\mathrm{pred} \in G'.\textsc{predecessors}(g')$}{
        \If{$\textsc{is2QGate}(\mathrm{pred})$}{
            % \tcp{Distinguish if they are a pair of commutative canonical gates (Theorem 1)}
            \If{$\textsc{isCommutativeCanonicalPair}(g',\, \text{pred})$}{
                $C[(\mathrm{pred}.q_0,\, \text{pred}.q_1)] \leftarrow (g'.q_0,\, g'.q_1)$\;
            }
            \Else{
                $L.\textsc{pop}((\mathrm{pred}.q_0,\, \mathrm{pred}.q_1),\, \textsc{None})$\;
                $C.\textsc{pop}((\mathrm{pred}.q_0,\, \mathrm{pred}.q_1),\, \textsc{None})$\;
            }
        }
        \Else{ 
            \tcc{$ \mathrm{pred\_pred} $ must be None or a 2Q gate}
            $\mathrm{pred\_pred} \leftarrow \textsc{next}(G'.\textsc{predecessors}(\mathrm{pred}))$\;
            \If{$\mathrm{pred\_pred} \neq \textsc{None}$}{
                $L.\textsc{pop}((\mathrm{pred\_pred}.q_0,\, \mathrm{pred\_pred}.q_1),\, \textsc{None})$\;
                $C.\textsc{pop}((\mathrm{pred\_pred}.q_0,\, \mathrm{pred\_pred}.q_1),\, \textsc{None})$\;
            }
        }
    }
    $L[(g'.q_0,\, g'.q_1)] \leftarrow g'$\;

\end{algorithm}

% \end{document}
